<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AllLife Bank ML Project – AI Solutions Workflow</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #080a0f;
    --surface: #10131a;
    --card: #181c28;
    --border: #222736;
    --text: #e4e8f0;
    --muted: #64748b;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(108,99,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(108,99,255,0.03) 1px, transparent 1px);
    background-size: 44px 44px;
    pointer-events: none; z-index: 0;
  }

  .wrapper {
    position: relative; z-index: 1;
    max-width: 1140px;
    margin: 0 auto;
    padding: 52px 24px 96px;
  }

  /* ── Header ── */
  .header { text-align: center; margin-bottom: 16px; animation: fadeDown 0.7s ease both; }

  .header .eyebrow {
    display: inline-flex; align-items: center; gap: 8px;
    font-size: 10px; letter-spacing: 0.28em;
    color: #a78bfa; text-transform: uppercase;
    margin-bottom: 16px; padding: 6px 16px;
    border: 1px solid rgba(167,139,250,0.25); border-radius: 20px;
    background: rgba(167,139,250,0.06);
  }

  .header h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(24px, 4vw, 44px);
    font-weight: 800; line-height: 1.1;
    background: linear-gradient(130deg, #fff 20%, #c4b5fd 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text; margin-bottom: 12px;
  }

  .header p { color: var(--muted); font-size: 12px; max-width: 620px; margin: 0 auto; line-height: 1.7; }

  /* ── Context bar ── */
  .context-bar {
    display: grid; grid-template-columns: repeat(4, 1fr);
    gap: 12px; margin: 32px 0 48px;
    animation: fadeUp 0.6s ease 0.1s both;
  }

  .ctx-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 12px; padding: 16px 18px;
    position: relative; overflow: hidden;
  }

  .ctx-card::after {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, #6c63ff, #a78bfa);
    opacity: 0.6;
  }

  .ctx-label { font-size: 9px; letter-spacing: 0.22em; text-transform: uppercase; color: var(--muted); margin-bottom: 6px; }
  .ctx-val { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 12.5px; color: var(--text); line-height: 1.35; }

  /* ── Model comparison table ── */
  .model-strip {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 14px; padding: 20px 24px;
    margin-bottom: 36px;
    animation: fadeUp 0.6s ease 0.15s both;
  }

  .model-strip-label {
    font-size: 9.5px; letter-spacing: 0.22em;
    text-transform: uppercase; color: var(--muted);
    margin-bottom: 14px;
  }

  .model-table { width: 100%; border-collapse: collapse; font-size: 11px; }
  .model-table th {
    text-align: left; padding: 7px 12px;
    color: var(--muted); font-weight: 400;
    border-bottom: 1px solid var(--border);
    font-size: 10px; letter-spacing: 0.1em;
  }
  .model-table td { padding: 8px 12px; border-bottom: 1px solid rgba(34,39,54,0.6); }
  .model-table tr:last-child td { border-bottom: none; }
  .model-table .winner { color: #34d399; font-weight: 500; }
  .model-table .badge {
    display: inline-block; padding: 2px 8px;
    border-radius: 10px; font-size: 9px;
    background: rgba(52,211,153,0.12);
    border: 1px solid rgba(52,211,153,0.3);
    color: #34d399; margin-left: 6px;
  }
  .model-table .badge-warn {
    background: rgba(251,191,36,0.1); border-color: rgba(251,191,36,0.3); color: #fbbf24;
  }

  /* ── Flow ── */
  .flow { display: flex; flex-direction: column; }

  .phase { animation: fadeUp 0.55s ease both; }
  .phase:nth-child(1) { animation-delay: 0.1s; }
  .phase:nth-child(2) { animation-delay: 0.18s; }
  .phase:nth-child(3) { animation-delay: 0.26s; }
  .phase:nth-child(4) { animation-delay: 0.34s; }
  .phase:nth-child(5) { animation-delay: 0.42s; }

  .phase-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 16px; cursor: pointer;
    transition: all 0.28s ease; position: relative; overflow: hidden;
  }

  .phase-card::before {
    content: '';
    position: absolute; left: 0; top: 0; bottom: 0;
    width: 4px; background: var(--phase-color);
    transition: width 0.28s ease;
  }

  .phase-card:hover { border-color: var(--phase-color); transform: translateX(5px); box-shadow: -5px 0 28px rgba(0,0,0,0.4), 0 0 36px -12px var(--phase-color); }
  .phase-card:hover::before, .phase-card.open::before { width: 6px; }
  .phase-card.open { border-color: var(--phase-color); box-shadow: 0 0 38px -12px var(--phase-color); }

  .phase-header { display: flex; align-items: center; gap: 16px; padding: 24px 28px; }

  .phase-num {
    width: 42px; height: 42px; border-radius: 10px;
    background: var(--phase-color);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif; font-weight: 800; font-size: 15px;
    color: #000; flex-shrink: 0;
  }

  .phase-title-block { flex: 1; }
  .phase-tag { font-size: 9.5px; letter-spacing: 0.22em; text-transform: uppercase; color: var(--phase-color); margin-bottom: 4px; }
  .phase-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 16px; color: var(--text); }
  .phase-pills { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }

  .phase-pill {
    font-size: 10px; padding: 3px 9px; border-radius: 12px;
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
    color: var(--muted); transition: all 0.2s;
  }
  .phase-card:hover .phase-pill, .phase-card.open .phase-pill { border-color: var(--phase-color); color: var(--text); background: rgba(255,255,255,0.06); }

  .phase-toggle {
    width: 30px; height: 30px; border-radius: 7px;
    border: 1px solid var(--border); background: var(--surface);
    display: flex; align-items: center; justify-content: center;
    transition: all 0.28s ease; flex-shrink: 0;
  }
  .phase-card.open .phase-toggle { background: var(--phase-color); border-color: var(--phase-color); transform: rotate(45deg); }
  .phase-toggle svg { width: 11px; height: 11px; stroke: var(--muted); fill: none; transition: stroke 0.2s; }
  .phase-card:hover .phase-toggle svg { stroke: var(--text); }
  .phase-card.open .phase-toggle svg { stroke: #000; }

  .phase-body { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.4s ease; }
  .phase-card.open .phase-body { grid-template-rows: 1fr; }
  .phase-body-inner { overflow: hidden; }

  .divider { height: 1px; background: var(--border); margin: 0 28px; }

  .phase-content {
    padding: 20px 28px;
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  .section-label { font-size: 9.5px; letter-spacing: 0.22em; text-transform: uppercase; color: var(--muted); margin-bottom: 10px; }

  .substep {
    display: flex; align-items: flex-start; gap: 9px;
    padding: 9px 12px; background: var(--surface); border-radius: 8px;
    margin-bottom: 7px; border: 1px solid var(--border);
    font-size: 11px; line-height: 1.55; transition: border-color 0.2s;
  }
  .substep:hover { border-color: var(--phase-color); }
  .substep-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--phase-color); margin-top: 4px; flex-shrink: 0; }

  .code-block {
    background: #0d1117; border: 1px solid #30363d; border-radius: 8px;
    padding: 10px 13px; margin-bottom: 7px; font-size: 10.5px;
    line-height: 1.65; color: #79c0ff; overflow-x: auto; white-space: pre;
  }
  .cm { color: #8b949e; }
  .kw { color: #ff7b72; }
  .fn { color: #d2a8ff; }
  .st { color: #a5d6ff; }
  .nm { color: #79c0ff; }
  .op { color: #f0883e; }

  .decision {
    display: flex; align-items: flex-start; gap: 9px;
    padding: 9px 12px; background: rgba(251,191,36,0.05);
    border: 1px solid rgba(251,191,36,0.18); border-radius: 8px;
    margin-bottom: 7px; font-size: 11px; line-height: 1.55;
  }
  .d-icon { font-size: 11px; flex-shrink: 0; margin-top: 2px; color: #fbbf24; }

  .output-row { padding: 14px 28px 22px; }
  .output-tags { display: flex; flex-wrap: wrap; gap: 7px; margin-top: 8px; }
  .output-tag {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 5px 12px; background: rgba(167,139,250,0.08);
    border: 1px solid rgba(167,139,250,0.22); border-radius: 20px;
    font-size: 11px; color: #a78bfa;
  }

  /* Connector */
  .connector { display: flex; flex-direction: column; align-items: center; padding: 4px 0; }
  .connector-line { width: 2px; height: 22px; background: linear-gradient(to bottom, var(--from-color), var(--to-color)); }
  .connector-arrow { width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 8px solid var(--to-color); }

  /* Legend */
  .legend { display: flex; justify-content: center; gap: 28px; margin-top: 52px; flex-wrap: wrap; }
  .legend-item { display: flex; align-items: center; gap: 8px; font-size: 11px; color: var(--muted); }
  .l-dot { width: 8px; height: 8px; border-radius: 2px; }
  .l-code { width: 16px; height: 8px; border-radius: 2px; background: #0d1117; border: 1px solid #30363d; }
  .l-diamond { width: 9px; height: 9px; background: rgba(251,191,36,0.4); transform: rotate(45deg); border: 1px solid rgba(251,191,36,0.6); border-radius: 1px; }
  .l-tag { width: 16px; height: 8px; border-radius: 8px; background: rgba(167,139,250,0.3); border: 1px solid rgba(167,139,250,0.5); }

  @keyframes fadeDown { from { opacity:0; transform:translateY(-18px); } to { opacity:1; transform:translateY(0); } }
  @keyframes fadeUp   { from { opacity:0; transform:translateY(18px);  } to { opacity:1; transform:translateY(0); } }

  @media (max-width: 720px) {
    .phase-content { grid-template-columns: 1fr; }
    .context-bar { grid-template-columns: 1fr 1fr; }
  }
  @media (max-width: 480px) { .context-bar { grid-template-columns: 1fr; } }

  /* ── Back to Portfolio ── */
  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 10px;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    color: var(--accent);
    text-decoration: none;
    padding: 7px 14px 7px 10px;
    border: 1px solid rgba(0,212,170,0.25);
    border-radius: 20px;
    background: rgba(0,212,170,0.05);
    margin-bottom: 32px;
    transition: all 0.2s ease;
    font-family: 'DM Mono', monospace;
  }
  .back-btn:hover {
    background: rgba(0,212,170,0.12);
    border-color: rgba(0,212,170,0.55);
    color: var(--accent);
    transform: translateX(-3px);
  }
  .back-btn svg {
    width: 12px; height: 12px;
    stroke: var(--accent);
    fill: none;
    flex-shrink: 0;
    transition: transform 0.2s;
  }
  .back-btn:hover svg { transform: translateX(-2px); }

</style>
</head>
<body>
<div class="wrapper">
  <a class="back-btn" href="ai-solutions-portfolio.html">
    <svg viewBox="0 0 12 12"><line x1="11" y1="6" x2="1" y2="6"/><polyline points="5,2 1,6 5,10"/></svg>
    Back to Portfolio
  </a>


  <div class="header">
    <div class="eyebrow">● UT Austin PGPAIML · Machine Learning Project</div>
    <h1>AllLife Bank Personal Loan<br>Campaign — ML Solutions Workflow</h1>
    <p>Applying a structured AI solutions methodology to a binary classification problem: predicting personal loan conversion among liability customers using Decision Tree models.</p>
  </div>

  <!-- Context bar -->
  <div class="context-bar">
    <div class="ctx-card">
      <div class="ctx-label">Client</div>
      <div class="ctx-val">AllLife Bank (US Retail Banking)</div>
    </div>
    <div class="ctx-card">
      <div class="ctx-label">Problem Type</div>
      <div class="ctx-val">Binary Classification</div>
    </div>
    <div class="ctx-card">
      <div class="ctx-label">Model</div>
      <div class="ctx-val">Decision Tree · Pre & Post Pruning</div>
    </div>
    <div class="ctx-card">
      <div class="ctx-label">Target Variable</div>
      <div class="ctx-val">Personal_Loan (0 = No, 1 = Yes)</div>
    </div>
  </div>

  <!-- Model comparison strip -->
  <div class="model-strip">
    <div class="model-strip-label">Model Comparison Summary — Key Metric: Recall (minimize false negatives)</div>
    <table class="model-table">
      <thead>
        <tr>
          <th>Model Variant</th>
          <th>Strategy</th>
          <th>Key Recall Goal</th>
          <th>Overfitting Risk</th>
          <th>Selected?</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Decision Tree (sklearn default)</td>
          <td>Gini criterion, no constraints</td>
          <td>Baseline</td>
          <td style="color:#f87171">High — fits training data perfectly</td>
          <td>No</td>
        </tr>
        <tr>
          <td>Decision Tree (Pre-Pruning)</td>
          <td>Grid search: max_depth, max_leaf_nodes, min_samples_split · class_weight=balanced</td>
          <td>Maximize recall, minimize train/test gap</td>
          <td style="color:#fbbf24">Medium — constrained by hyperparams</td>
          <td>Candidate</td>
        </tr>
        <tr>
          <td class="winner">Decision Tree (Post-Pruning) <span class="badge">Recommended</span></td>
          <td>CCP alpha path · class_weight={0:0.15, 1:0.85}</td>
          <td>Best test recall with generalization</td>
          <td style="color:#34d399">Low — alpha controls complexity</td>
          <td class="winner">✓ Best Model</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="flow" id="flow"></div>

  <div class="legend">
    <div class="legend-item"><div class="l-dot" style="background:#818cf8"></div>Process Step</div>
    <div class="legend-item"><div class="l-code"></div>Code Reference</div>
    <div class="legend-item"><div class="l-diamond"></div>Decision Gate</div>
    <div class="legend-item"><div class="l-tag"></div>Output / Deliverable</div>
  </div>

</div>

<script>
const phases = [
  {
    num: "01",
    tag: "Phase One",
    title: "Requirements Gathering & Business Problem Definition",
    color: "#818cf8",
    pills: ["Stakeholder Context", "Business Objective", "Data Dictionary"],
    steps: [
      "Engage AllLife Bank retail marketing department to understand the loan conversion campaign objective — 9% baseline conversion from last year's pilot establishes the benchmark to beat",
      "Define the primary business goal: build a classification model that identifies which liability customers (depositors) are most likely to accept a personal loan offer",
      "Document the success metric from a business lens: improving campaign conversion rate, reducing cost-per-acquisition, and maximizing loan portfolio quality — not just model accuracy",
      "Review the 14-variable data dictionary: demographic (Age, Income, Education), behavioral (CCAvg, Online, CreditCard), and product relationship features (CD_Account, Securities_Account, Mortgage)",
      "Confirm the target variable: Personal_Loan (binary: 0 = declined, 1 = accepted) — establish that class imbalance (~9% positive class) is a critical modeling consideration"
    ],
    code: [
`<span class="cm"># Load and preserve original data</span>
<span class="nm">Loan</span> = <span class="fn">pd.read_csv</span>(<span class="st">"Loan_Modelling.csv"</span>)
<span class="nm">data</span> = <span class="nm">Loan</span>.<span class="fn">copy</span>()  <span class="cm"># never modify raw data</span>
<span class="nm">data</span>.<span class="fn">head</span>()`,
`<span class="cm"># Structural overview</span>
<span class="nm">data</span>.<span class="nm">shape</span>    <span class="cm"># rows × columns</span>
<span class="nm">data</span>.<span class="fn">dtypes</span>   <span class="cm"># confirm data types</span>
<span class="nm">data</span>.<span class="fn">describe</span>().<span class="nm">T</span>  <span class="cm"># statistical summary</span>`
    ],
    decisions: [
      "Is recall or precision the priority metric? → Given the cost of missing a likely loan adopter (false negative) vs. wasting a marketing contact (false positive), RECALL is the business-critical metric",
      "Is the 9% positive class rate sufficient for modeling? → Class imbalance must be addressed — plan for class_weight balancing in model configuration"
    ],
    outputs: ["Business Problem Statement", "Target Variable & Class Imbalance Assessment", "Feature Inventory (14 variables)", "Primary Metric Definition: Recall"]
  },
  {
    num: "02",
    tag: "Phase Two",
    title: "Problem Framing, Data Quality & Feature Engineering",
    color: "#a78bfa",
    pills: ["Anomaly Handling", "Feature Engineering", "Outlier Detection"],
    steps: [
      "Identify and correct data anomalies: negative Experience values (-1, -2, -3) are replaced with their positive equivalents — a business logic correction, not imputation",
      "Engineer the ZIPCode feature: reduce 467 unique ZIP codes to 2-digit regional prefixes (yielding ~8 groups) — preserves geographic signal without overfitting to hyper-granular location data",
      "Cast categorical features to correct data types: Education, Personal_Loan, Securities_Account, CD_Account, Online, CreditCard, and ZIPCode converted to 'category' dtype",
      "Drop non-predictive identifier: remove ID column as it carries no signal for loan conversion prediction",
      "Run IQR-based outlier detection across numerical columns — document which features contain outliers and assess whether to cap, transform, or retain them for tree-based modeling (trees are outlier-robust)"
    ],
    code: [
`<span class="cm"># Fix negative experience values</span>
<span class="nm">data</span>[<span class="st">"Experience"</span>].<span class="fn">replace</span>({<span class="op">-1</span>:<span class="op">1</span>, <span class="op">-2</span>:<span class="op">2</span>, <span class="op">-3</span>:<span class="op">3</span>}, <span class="nm">inplace</span>=<span class="kw">True</span>)

<span class="cm"># Compress ZIPCode to 2-digit prefix</span>
<span class="nm">data</span>[<span class="st">"ZIPCode"</span>] = <span class="nm">data</span>[<span class="st">"ZIPCode"</span>].<span class="fn">astype</span>(<span class="st">str</span>).<span class="fn">str</span>[<span class="op">0</span>:<span class="op">2</span>]
<span class="nm">data</span>[<span class="st">"ZIPCode"</span>] = <span class="nm">data</span>[<span class="st">"ZIPCode"</span>].<span class="fn">astype</span>(<span class="st">"category"</span>)`,
`<span class="cm"># IQR outlier detection</span>
<span class="nm">Q1</span> = <span class="nm">data</span>.<span class="fn">select_dtypes</span>(<span class="st">"number"</span>).<span class="fn">quantile</span>(<span class="op">0.25</span>)
<span class="nm">Q3</span> = <span class="nm">data</span>.<span class="fn">select_dtypes</span>(<span class="st">"number"</span>).<span class="fn">quantile</span>(<span class="op">0.75</span>)
<span class="nm">IQR</span> = <span class="nm">Q3</span> - <span class="nm">Q1</span>
<span class="cm"># % of outliers per column</span>`
    ],
    decisions: [
      "Should outliers be removed or retained? → Decision trees are inherently robust to outliers — retain them to avoid information loss in features like Mortgage and CCAvg",
      "Drop Experience or retain it? → Experience is near-perfectly correlated with Age (linear relationship); drop it to prevent multicollinearity from inflating false feature importance"
    ],
    outputs: ["Cleaned Dataset (anomalies corrected)", "Engineered ZIPCode Feature", "Typed Categorical Columns", "Outlier Assessment Report", "Final Feature Set: 12 predictors"]
  },
  {
    num: "03",
    tag: "Phase Three",
    title: "Exploratory Data Analysis — Patterns & Drivers",
    color: "#c084fc",
    pills: ["Univariate EDA", "Bivariate EDA", "Correlation Analysis"],
    steps: [
      "Univariate analysis: histogram + boxplot combos for Age, Income, CCAvg, Mortgage, Experience — identify distributions and confirm which features are right-skewed (Mortgage, CCAvg)",
      "Categorical distributions: labeled barplots for Education, CreditCard, Securities_Account, CD_Account, Online, ZIPCode — understand baseline composition of customer base",
      "Bivariate analysis vs. target: stacked barplots for all categorical features vs. Personal_Loan — identify which segments (e.g., CD_Account holders, higher education) show disproportionately high loan acceptance",
      "Distribution plots split by loan outcome for numerical features (Age, Income, CCAvg, Experience) — compare loan acceptors vs. non-acceptors across each dimension",
      "Correlation heatmap across numerical variables — confirm Income and CCAvg are the strongest numerical correlates of loan acceptance; confirm Age/Experience collinearity"
    ],
    code: [
`<span class="cm"># Stacked barplot: CD_Account vs loan</span>
<span class="fn">stacked_barplot</span>(<span class="nm">data</span>, <span class="st">"CD_Account"</span>, <span class="st">"Personal_Loan"</span>)

<span class="cm"># Income distribution split by target</span>
<span class="fn">distribution_plot_wrt_target</span>(<span class="nm">data</span>, <span class="st">'Income'</span>, <span class="st">'Personal_Loan'</span>)`,
`<span class="cm"># Correlation heatmap</span>
<span class="fn">sns.heatmap</span>(
  <span class="nm">data</span>.<span class="fn">corr</span>(<span class="nm">numeric_only</span>=<span class="kw">True</span>),
  <span class="nm">annot</span>=<span class="kw">True</span>, <span class="nm">vmin</span>=<span class="op">-1</span>, <span class="nm">vmax</span>=<span class="op">1</span>,
  <span class="nm">fmt</span>=<span class="st">".2f"</span>, <span class="nm">cmap</span>=<span class="st">"Spectral"</span>
)`
    ],
    decisions: [
      "Which features show the strongest signal for loan acceptance? → Income, CCAvg, CD_Account, and Education are the primary drivers — these should be weighted appropriately in model evaluation",
      "Are there multicollinear features to drop before modeling? → Age and Experience are highly correlated — drop Experience; retain Age as it's more interpretable for business stakeholders"
    ],
    outputs: ["Univariate Distribution Charts", "Bivariate Stacked Barplots (all categoricals vs. target)", "Correlation Heatmap (Q3)", "Key Driver Narrative: Income, CCAvg, CD_Account, Education"]
  },
  {
    num: "04",
    tag: "Phase Four",
    title: "Model Building, Tuning & Comparative Evaluation",
    color: "#e879f9",
    pills: ["Train/Test Split", "Pre-Pruning", "Post-Pruning", "Feature Importance"],
    steps: [
      "Prepare model-ready data: one-hot encode ZIPCode and Education (drop_first=True to avoid dummy variable trap); drop Experience; define X (12 features) and Y (Personal_Loan); cast all to float",
      "Split 70/30 train/test with random_state=1 — verify class distribution is preserved across both splits before proceeding",
      "Baseline model: sklearn default DecisionTreeClassifier (Gini criterion) — establishes performance ceiling, confirms overfitting risk via perfect training recall vs. degraded test recall",
      "Pre-pruning: grid search over max_depth (2–6), max_leaf_nodes (50–250), min_samples_split (10–70) with class_weight='balanced' — select model minimizing train/test recall gap while maximizing test recall",
      "Post-pruning: cost-complexity pruning path (ccp_alpha) — train tree family across alpha range, plot recall vs. alpha, select alpha at peak test recall with class_weight={0:0.15, 1:0.85} for aggressive minority class weighting"
    ],
    code: [
`<span class="cm"># Train/test split</span>
<span class="nm">X_train</span>, <span class="nm">X_test</span>, <span class="nm">y_train</span>, <span class="nm">y_test</span> = <span class="fn">train_test_split</span>(
    <span class="nm">X</span>, <span class="nm">Y</span>, <span class="nm">test_size</span>=<span class="op">0.30</span>, <span class="nm">random_state</span>=<span class="op">1</span>
)
<span class="cm"># Check class balance in each split</span>
<span class="nm">y_train</span>.<span class="fn">value_counts</span>(<span class="nm">normalize</span>=<span class="kw">True</span>)`,
`<span class="cm"># Post-pruning: CCP alpha path</span>
<span class="nm">path</span> = <span class="fn">DecisionTreeClassifier</span>(<span class="nm">random_state</span>=<span class="op">1</span>).<span class="fn">cost_complexity_pruning_path</span>(<span class="nm">X_train</span>, <span class="nm">y_train</span>)
<span class="cm"># Select best alpha by peak test recall</span>
<span class="nm">index_best</span> = <span class="fn">np.argmax</span>(<span class="nm">recall_test</span>)
<span class="nm">best_alpha</span> = <span class="nm">clfs</span>[<span class="nm">index_best</span>].<span class="nm">ccp_alpha</span>`
    ],
    decisions: [
      "Pre-pruning vs. post-pruning: which generalizes better? → Compare test recall AND train/test gap — post-pruning with ccp_alpha typically yields a cleaner bias-variance tradeoff for this dataset",
      "How aggressive should class weighting be? → With ~9% positive class, setting class_weight={0:0.15, 1:0.85} strongly penalizes false negatives — appropriate when missing a loan prospect is costlier than a wasted contact"
    ],
    outputs: ["Baseline Decision Tree (Gini)", "Pre-Pruned Model (best hyperparams)", "Post-Pruned Model (best ccp_alpha)", "Feature Importance Rankings", "Confusion Matrices (train & test, all 3 models)"]
  },
  {
    num: "05",
    tag: "Phase Five",
    title: "Model Selection, Insights & Business Recommendations",
    color: "#f472b6",
    pills: ["Model Comparison", "Feature Drivers", "Campaign Strategy", "Roadmap"],
    steps: [
      "Compare all three model variants side-by-side on Accuracy, Recall, Precision, and F1 for both train and test sets — select the post-pruned model as it maximizes test recall with lowest overfitting",
      "Extract and rank feature importances (Gini importance) — communicate top drivers in business language: 'Customers with higher income, CD accounts, and graduate/advanced education are most likely to accept a loan offer'",
      "Translate model outputs into campaign targeting logic: score all liability customers, rank by predicted probability, and focus outreach budget on the top probability deciles",
      "Quantify expected campaign improvement: if the model correctly identifies 85%+ of actual loan acceptors (recall target), the bank can dramatically reduce mass-marketing waste and focus on high-intent segments",
      "Define follow-on ML roadmap: ensemble models (Random Forest, XGBoost) for accuracy gains; probability calibration for scoring reliability; real-time scoring API integration with CRM for live campaign targeting"
    ],
    code: [
`<span class="cm"># Side-by-side model comparison</span>
<span class="nm">models_test_comp_df</span> = <span class="fn">pd.concat</span>([
    <span class="nm">decision_tree_perf_test</span>.<span class="nm">T</span>,
    <span class="nm">decision_tree_tune_perf_test</span>.<span class="nm">T</span>,
    <span class="nm">decision_tree_tune_post_test</span>.<span class="nm">T</span>
], <span class="nm">axis</span>=<span class="op">1</span>)
<span class="nm">models_test_comp_df</span>.<span class="nm">columns</span> = [<span class="st">"Default"</span>, <span class="st">"Pre-Pruned"</span>, <span class="st">"Post-Pruned"</span>]`,
`<span class="cm"># Feature importance visualization</span>
<span class="fn">pd.DataFrame</span>(
    <span class="nm">estimator_2</span>.<span class="nm">feature_importances_</span>,
    <span class="nm">columns</span>=[<span class="st">"Imp"</span>],
    <span class="nm">index</span>=<span class="nm">X_train</span>.<span class="nm">columns</span>
).<span class="fn">sort_values</span>(<span class="nm">by</span>=<span class="st">"Imp"</span>, <span class="nm">ascending</span>=<span class="kw">False</span>)`
    ],
    decisions: [
      "Is the selected model ready for production deployment? → If test recall meets the business threshold (>80% recommended), proceed to CRM integration scoping; if not, escalate to ensemble modeling",
      "Should the model be re-trained periodically? → Yes — customer behavior and product mix will drift; recommend quarterly retraining cadence with monitored recall degradation as the trigger"
    ],
    outputs: ["Final Model: Post-Pruned Decision Tree", "Feature Importance Report (business narrative)", "Campaign Targeting Recommendations", "Model Performance Comparison Table", "Follow-On ML Roadmap (Random Forest, XGBoost, CRM API)"]
  }
];

const connectors = [
  { from: '#818cf8', to: '#a78bfa' },
  { from: '#a78bfa', to: '#c084fc' },
  { from: '#c084fc', to: '#e879f9' },
  { from: '#e879f9', to: '#f472b6' },
];

const flow = document.getElementById('flow');

phases.forEach((phase, i) => {
  const phaseEl = document.createElement('div');
  phaseEl.className = 'phase';
  phaseEl.innerHTML = `
    <div class="phase-card" style="--phase-color:${phase.color}" id="phase-${i}">
      <div class="phase-header">
        <div class="phase-num">${phase.num}</div>
        <div class="phase-title-block">
          <div class="phase-tag">${phase.tag}</div>
          <div class="phase-title">${phase.title}</div>
          <div class="phase-pills">${phase.pills.map(p => `<span class="phase-pill">${p}</span>`).join('')}</div>
        </div>
        <div class="phase-toggle">
          <svg viewBox="0 0 12 12"><line x1="6" y1="1" x2="6" y2="11"/><line x1="1" y1="6" x2="11" y2="6"/></svg>
        </div>
      </div>

      <div class="phase-body">
        <div class="phase-body-inner">
          <div class="divider"></div>
          <div class="phase-content">
            <div>
              <div class="section-label">Process Steps</div>
              ${phase.steps.map(s => `<div class="substep"><div class="substep-dot"></div><span>${s}</span></div>`).join('')}
            </div>
            <div>
              <div class="section-label">Code Reference</div>
              ${phase.code.map(c => `<div class="code-block">${c}</div>`).join('')}
              <div style="height:14px"></div>
              <div class="section-label">Decision Gates</div>
              ${phase.decisions.map(d => `<div class="decision"><div class="d-icon">◆</div><span>${d}</span></div>`).join('')}
            </div>
          </div>
          <div class="divider"></div>
          <div class="output-row">
            <div class="section-label">Phase Outputs & Deliverables</div>
            <div class="output-tags">${phase.outputs.map(o => `<span class="output-tag">→ ${o}</span>`).join('')}</div>
          </div>
        </div>
      </div>
    </div>
  `;

  phaseEl.querySelector('.phase-card').addEventListener('click', function () {
    const isOpen = this.classList.contains('open');
    document.querySelectorAll('.phase-card').forEach(c => c.classList.remove('open'));
    if (!isOpen) this.classList.add('open');
  });

  flow.appendChild(phaseEl);

  if (i < phases.length - 1) {
    const c = connectors[i];
    const conn = document.createElement('div');
    conn.className = 'connector';
    conn.innerHTML = `
      <div class="connector-line" style="--from-color:${c.from};--to-color:${c.to}"></div>
      <div class="connector-arrow" style="--to-color:${c.to}"></div>
    `;
    flow.appendChild(conn);
  }
});

document.getElementById('phase-0').classList.add('open');
</script>
</body>
</html>
